# 非指针切片转换指针切片和指针与非指针返回的性能分析
- 基准测试 循环时获取有效地址的两种操作
- 一种是使用临时变量, 一种是使用索用获取(推荐使用)
- 效率深入分析
-  使用方法: ./compile.sh 运行得知结果

# 导航
1. [使用临时变量操作](#使用临时变量操作)
1. [获取地址性能分析](#获取地址性能分析)
1. [结论](#结论)


## 使用临时变量操作
```
func tmpS0() {
 	data := []int{1,2,3,4,5}
 	for _, val := range data {
 	    val := val//使用临时变量
 		_ = &val
	}
 }
```

## 使用索引获取地址操作(推荐使用)
```
 func keyS1() {
	 data := []int{1,2,3,4,5}
	 for key := range data {
		 _ = &data[key] //使用索用获取
	 }
 }
 ```

## 错误操作, 每次获取最后一个地址
- 输出结果:输出最后同一个地址
- 在执行for循环的时候，golang会首先创建一块内存，用于存放item。
- 之后依次将list中的元素拷贝到这块内存，在for之后若没有继续引用便进行释放，
- 所以在此过程中，修改item或将item放入其他的map中，只会放入最后一个元素。

```
//错误写法,
func s0() {
	data := []int{1,2,3,4,5,6}
	for _, val := range data {
		fmt.Println(&val)
	}
}
```

```
0xc420014060
0xc420014060
0xc420014060
0xc420014060
0xc420014060
0xc420014060
```


## 获取地址性能分析

### 小数据, 简单切片操作, 大约100个数据
> 性能相差4倍左右 <br/>
  推荐指针操作时使用:索引获取地址

```
小数据的指针切片赋值(一个使用临时变量,一个使用索引) s1 和 s2 简单的基准测试
Benchmark小数据100_简单切片操作0-4                                500000              2311 ns/op            2840 B/op        108 allocs/op
Benchmark小数据100_简单切片操作1-4                               2000000               839 ns/op            2040 B/op          8 allocs/op
性能相差4倍左右
推荐指针操作时使用:索引获取地址
```

### 小数据, 结构操作,大约100个
> 性能相差10倍左右<br/>
  推荐指针操作时使用:索引获取地址

```
小数据结构体操作

Benchmark小数据100_结构操作0-4                           2000000               699 ns/op               8 B/op          0 allocs/op
Benchmark小数据100_结构操作1-4                          20000000                68.5 ns/op             0 B/op          0 allocs/op
性能相差10倍左右
推荐指针操作时使用:索引获取地址
```

### 中数据, 结构体操作, 大约1000个数据
> 性能相差10倍左右<br/>
  推荐指针操作时使用:索引获取地址

```
中数据结构体操作

Benchmark中数据1000_结构操作0-4                           200000              7069 ns/op             846 B/op          0 allocs/op
Benchmark中数据1000_结构操作1-4                          2000000               592 ns/op              84 B/op          0 allocs/op
性能相差10倍左右
推荐指针操作时使用:索引获取地址
```

### 大数据, 结构体操作, 大约5000个数据
> 性能相差10倍左右<br/>
  推荐指针操作时使用:索引获取地址

```
大数据结构体操作

Benchmark大数据5000_结构操作0-4                            30000             42540 ns/op           28253 B/op          0 allocs/op
Benchmark大数据5000_结构操作1-4                           300000              3508 ns/op            2825 B/op          0 allocs/op
性能相差10倍左右
推荐指针操作时使用:索引获取地址
```

## 指针与非指针数据返回

### 指针与非指针数据返回, 结构体操作, 大约5000个数据
> 性能相差10倍左右<br/>
  推荐指针操作时使用:索引获取地址

```
指针与非指针数据返回操作

Benchmark非指针结构5000_返回操作0-4                                 3000            408176 ns/op         1797987 B/op         24 allocs/op
Benchmark有指针结构5000_返回操作1-4                                30000             93699 ns/op          185173 B/op         17 allocs/op
性能相差10倍左右
推荐指针操作时使用:索引获取地址
```

## 结论
- 循环获取数据,操作指针切片,推荐使用: 索引获取,小数据(小于等于100)性能相差4倍, 大数据(大约1000~5000)性能相差明显10倍之差.
- 返回切片数据时,推荐使用指针返回, 性能相差10倍.